# Repo Scan + Docs/Canvas Alignment Report

Updated: 2026-02-19

This document is an **evidence-based reality check** of the current repository against the planned feature set in `/Docs`.

It is intended to:
- identify **what is actually implemented in code today**
- flag **doc/status drift** (âœ…/ğŸŸ¡/ğŸ”´ mismatches)
- list the **highest-value remaining work** to reach â€œplan completionâ€ safely

> Docs are LAW. Where reality differs, we update docs **additively** to match reality while preserving planned features.

---

## 1) Executive summary

### Current health
- **Build:** âœ… Green
- **Tests:** âœ… Green (contract tests restored)
- **UI:** âœ… Green (no fatal JS errors)
- **Console noise:** ğŸŸ¡ Persistent 404 spam for malformed status route `/api/v1/childre_<id>/status`
  - Server includes a legacy compat shim, but users may still see noise due to cached/older UI assets.

### Key doc/status drift fixed in this pass
- **Reports scheduling:** upgraded from â€œğŸŸ¢/stubâ€ â†’ **âœ… implemented** (local scheduling + run-now + activity emit).
- **Activity feed/export:** upgraded from â€œplannedâ€ â†’ **âœ… implemented** (retention + export envelope).
- **Audit log:** downgraded from â€œimplementedâ€ assumptions â†’ **ğŸŸ¡ partial** (UI exists, server API/SSOT stream backing is not yet complete).

---

## 2) Canonical SSOT surfaces (validated)

### DashboardServer Control Plane
- SSOT store: `src/Safe0ne.DashboardServer/ControlPlane/JsonFileControlPlane.cs` (+ domain partials)
- Local-mode API group: `/api/local/*` (minimal APIs in `src/Safe0ne.DashboardServer/Program.cs`)

### Shared contracts
- `src/Safe0ne.Shared.Contracts/*`
- Typed IDs exist and are used across Parent/Server/Child.

### Web UI modularization
- Router stays thin: `src/Safe0ne.DashboardServer/wwwroot/app/router.js`
- Feature modules: `src/Safe0ne.DashboardServer/wwwroot/app/features/*`
- API client: `src/Safe0ne.DashboardServer/wwwroot/app/api.js`

---

## 3) Feature scan vs Docs plan

> Source of planned features: 
> - `Docs/00_Shared/Feature_Registry.md`
> - `Docs/10_Parent_App/Implementation_Matrix.md`
> - `Docs/20_Child_App/Implementation_Matrix.md`

### Implemented (âœ…) highlights
- Parent shell + WebView2 host
- Children list/cards + add child modal + avatar + profile tabs
- DevTools unlock + toggles
- Requests loop (kid request â†’ parent approve/deny â†’ kid applies grant)
- Alerts inbox (routing + grouping + ack persisted)
- Reports scheduling (local digest) + â€œrun nowâ€ + activity emit
- Geofences: authoring overlay + kid evaluation + events
- Activity: retention + export envelope + event capture for at least geofence + report_digest

### Partial (ğŸŸ¡) / remaining work (high-level)

| Area | Planned in Docs | Repo reality (today) | What remains to reach âœ… |
|---|---|---|---|
| Devices pairing UX | Pair device to child, device list, revoke token flows | ğŸŸ¡ Local pairing endpoints + registry exist; UX and hardening still evolving | Tighten mapping invariants, TTL/revoke behavior, tests for multi-device, clearer UI flows |
| Device health | Status badges/last-seen/diagnostics | ğŸŸ¡ Status surfaces exist; console noise indicates legacy callers; health enrichment incomplete | Define canonical status contract; add â€œoffline / never seenâ€ semantics; diagnostics bundle packaging |
| Policy sync runtime hardening | fingerprint/version/watchdog/rollback | ğŸŸ¡ Pieces exist; full integrity/repair loop not complete | Complete watchdog semantics; apply-ack and rollback gating; integrity checks |
| Enforcement: Screen time | enforce configured budgets/schedules | ğŸŸ¡ Config exists; enforcement not fully proven end-to-end | Enforce on Windows agent; block screens + warnings; verified telemetry |
| Enforcement: App limits | per-app limits enforcement | ğŸŸ¡ Authoring exists; enforcement TBD | Implement tracking + enforcement; request loop integration |
| Enforcement: Web safety | category/domain blocks + signals | ğŸŸ¡ Toggles exist; enforcement TBD | Implement filtering + logging + circumvention signals |
| Kid UX completion | Today/Blocked/Why/Request + emergency access | ğŸŸ¡ UX exists; emergency access/edge flows incomplete | Finish UX â€œwhyâ€ reasons + emergency rules; stable navigation |
| Audit log | append-only viewer | ğŸŸ¡ UI exists but API/SSOT stream not complete | Implement SSOT append-only chain + endpoints + export/search filters |
| ControlPlane partial split | domain partials cleanly split | ğŸŸ¡ In-flight (Tokens split incomplete) | Finish Tokens partial, reduce helper duplication, remove dead compat |

---

## 4) Known issues / tech debt surfaced

### Console 404 spam (non-fatal)
- Symptom: repeated 404s to `/api/v1/childre_<id>/status`
- Canonical route: `/api/v1/children/{childId:guid}/status`
- Compatibility shim is tracked in `Docs/00_Shared/Legacy-Code-Registry.md`.

**Likely cause:** cached/older UI assets or legacy caller building malformed URLs.

**Preferred fix:** find and remove the malformed caller (client-side) rather than keeping shims long term.

---

## 5) Recommended next slices (safe order)

1) **Stability wave: Tokens/revoke/compat canonicalization** (reduce churn risk)
2) **Device pairing hardening** (TTL/revoke + mapping invariants + tests)
3) **Device health semantics** (canonical offline/online + last-seen + diagnostics metadata)
4) **Audit log SSOT + endpoint** (make Adminâ†’Audit real)
5) **Kid enforcement completion (incremental):** screen time â†’ apps â†’ web

---

## 6) Files updated in this pass

- `Docs/00_Shared/Feature_Registry.md`
- `Docs/10_Parent_App/Implementation_Matrix.md`
- `Docs/20_Child_App/Implementation_Matrix.md`
- `Docs/00_Shared/Repo_Scan_2026-02-19.md` (this file)

